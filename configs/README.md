# Configs

This folder contains YAML configs used by Tripod and the bundled smoke tests.
The sections below explain what each config block does and where it is used.
Legacy configs that use `rag.training` / `rag.inference` are coerced to `raft` and
`rag` at load time for compatibility.

## Files

- `configs/smoke_e2e_config.yaml`: end-to-end smoke test config used by
  `tests/smoke_e2e.py`.
- `configs/iot_domain_config.yaml`: example production config
  (treat as inspiration and replace paths/values).

## What each section controls

### `training.*` (core/training.py)

- `training.enabled`: skip adapter training when false.
- `training.base_model`: base checkpoint loaded by the trainer and evaluator.
- `training.dataset_path`: training JSON/JSONL/text path (the smoke test
  overwrites this with its generated dataset paths).
- `training.adapter_output_dir`: output directory for LoRA/QLoRA adapters.
- `training.hyperparameters.response_marker`: delimiter that splits prompt vs
  completion inside the training text.
- `training.hyperparameters.mask_prompt`: if true, only completion tokens
  contribute to loss (labels are masked with `-100`).

### `raft.*` (RAFT) + `rag.*` (RAG) (core/rag.py)

- `raft.enabled`: enable training-time retrieval (RAFT) when building
  training examples in `tests/smoke_e2e.py`.
- `rag.enabled`: enable inference-time retrieval in `main.py` and
  the smoke evaluator.
- `rag.vector_db_path` / `raft.vector_db_path`: local vector store path (shared or separate).
- `rag.ingestion.embedding_model` / `raft.ingestion.embedding_model`: sentence-transformers model used to embed docs.
- `rag.retrieval.top_k` / `raft.retrieval.top_k`: number of docs to return per query.
- `rag.retrieval.strategy` / `raft.retrieval.strategy`: strategy label (currently used for logging).

### `prompting.*` (core/prompting.py)

- `prompting.system_prompt` and `prompting.user_prompt_structure`: prompt template.
- `prompting.backend`: `raw` renders the template; `dspy` executes a DSPy program.
- `prompting.dspy.*`: DSPy options used when `prompting.backend: dspy`.
- `prompting.few_shot`: only used by `tests/smoke_local.py` (not by core).

### `evaluation.*` (tests/smoke_e2e.py)

- `evaluation.test_set_path`: smoke test eval split path (generated by the script).
- `evaluation.metrics`: labels for report outputs (script-defined).
- `evaluation.generation.top_p`: nucleus sampling for evaluator decoding; if
  `top_p < 1.0` and `do_sample` is not set, sampling is enabled automatically.
- `evaluation.generation.do_sample`: explicit sampling toggle for evaluator decoding.

### Entry points

- `TripodOrchestrator.execute("ingest", {"documents": [...], "target": "raft"})`
  builds the RAFT vector store.
- `TripodOrchestrator.execute("ingest", {"documents": [...], "target": "rag"})`
  builds the inference RAG vector store.
- `TripodOrchestrator.execute("train")` runs training against
  `training.dataset_path`.
